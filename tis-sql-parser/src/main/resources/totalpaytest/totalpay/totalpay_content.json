{
  "nodes": [
    {
      "id": "683deaa9-92c6-0022-1d27-40ba500077e5",
      "x": 770,
      "y": 116,
      "shape": "image",
      "img": "/images/icon/table.svg",
      "size": [
        40,
        40
      ],
      "style": {
        "cursor": "pointer"
      },
      "nodeMeta": {
        "nodeMeta": {
          "type": "table",
          "img": "table.svg",
          "size": [
            40,
            40
          ],
          "label": "数据表"
        },
        "nodeid": "683deaa9-92c6-0022-1d27-40ba500077e5",
        "sqlcontent": "SELECT totalpay_id,curr_date,outfee,source_amount,discount_amount,result_amount,recieve_amount,ratio,status,entity_id,is_valid,create_time,op_time,last_ver,op_user_id,discount_plan_id,operator,operate_date,card_id,card,card_entity_id,is_full_ratio,is_minconsume_ratio,is_servicefee_ratio,invoice_code,invoice_memo,invoice,over_status,is_hide,load_time,modify_time,printnum1,printnum2,coupon_discount,ext,discount_amount_receivables,result_amount_receivables\nFROM totalpayinfo",
        "dbid": "58",
        "tabid": "56",
        "tabname": "totalpayinfo"
      },
      "label": "totalpayinfo"
    },
    {
      "id": "d56d4423-33dc-2adc-c5a8-e26df611df77",
      "x": 324,
      "y": 108,
      "shape": "image",
      "img": "/images/icon/table.svg",
      "size": [
        40,
        40
      ],
      "style": {
        "cursor": "pointer"
      },
      "nodeMeta": {
        "nodeMeta": {
          "type": "table",
          "img": "table.svg",
          "size": [
            40,
            40
          ],
          "label": "数据表"
        },
        "nodeid": "d56d4423-33dc-2adc-c5a8-e26df611df77",
        "sqlcontent": "SELECT order_id,global_code,simple_code,seat_code,code,curr_date,totalpay_id,seat_id,people_count,open_time,status,memo,inner_code,menutime_id,worker_id,end_time,feeplan_id,op_user_id,order_from,order_kind,area_id,name,mobile,tel,is_autocommit,send_time,address,paymode,outfee,sender_id,customerregister_id,waitingorder_id,send_status,audit_status,is_hide,entity_id,is_valid,create_time,op_time,last_ver,load_time,modify_time,is_limittime,scan_url,seat_mark,reservetime_id,is_wait,is_print,book_id,reserve_id,orign_id,reserve_status,ext\nFROM orderdetail",
        "dbid": "58",
        "tabid": "57",
        "tabname": "orderdetail"
      },
      "label": "orderdetail"
    },
    {
      "id": "e6c9be82-d622-4e0f-db4e-f94df75518f3",
      "x": 431,
      "y": 104,
      "shape": "image",
      "img": "/images/icon/table.svg",
      "size": [
        40,
        40
      ],
      "style": {
        "cursor": "pointer"
      },
      "nodeMeta": {
        "nodeMeta": {
          "type": "table",
          "img": "table.svg",
          "size": [
            40,
            40
          ],
          "label": "数据表"
        },
        "nodeid": "e6c9be82-d622-4e0f-db4e-f94df75518f3",
        "sqlcontent": "SELECT id,order_id,status,paid_fee,outfee,origin_amount,origin_service_charge,origin_least_amount,agio_amount,agio_service_charge,agio_least_amount,origin_receivables_amount,agio_receivables_amount,entity_id,ext,is_valid,agio_total,last_ver,op_user_id,reserve_amount,origin_total,final_amount,use_cash_promotion,create_time,modify_time,op_time,load_time,agio_total_receivables,agio_receivables_amount_receivables,final_amount_receivables\nFROM order_bill",
        "dbid": "58",
        "tabid": "58",
        "tabname": "order_bill"
      },
      "label": "order_bill"
    },
    {
      "id": "a240c9ca-93da-6e79-6712-c7d2de4f2629",
      "x": 629,
      "y": 113,
      "shape": "image",
      "img": "/images/icon/table.svg",
      "size": [
        40,
        40
      ],
      "style": {
        "cursor": "pointer"
      },
      "nodeMeta": {
        "nodeMeta": {
          "type": "table",
          "img": "table.svg",
          "size": [
            40,
            40
          ],
          "label": "数据表"
        },
        "nodeid": "a240c9ca-93da-6e79-6712-c7d2de4f2629",
        "sqlcontent": "SELECT specialfee_id,totalpay_id,order_id,kind,feedetail_id,fee,entity_id,is_valid,create_time,op_time,last_ver,op_user_id,load_time,modify_time\nFROM specialfee",
        "dbid": "58",
        "tabid": "59",
        "tabname": "specialfee"
      },
      "label": "specialfee"
    },
    {
      "id": "f9e4a170-3f57-d541-b27e-b089ebf1ba75",
      "x": 546,
      "y": 109,
      "shape": "image",
      "img": "/images/icon/table.svg",
      "size": [
        40,
        40
      ],
      "style": {
        "cursor": "pointer"
      },
      "nodeMeta": {
        "nodeMeta": {
          "type": "table",
          "img": "table.svg",
          "size": [
            40,
            40
          ],
          "label": "数据表"
        },
        "nodeid": "f9e4a170-3f57-d541-b27e-b089ebf1ba75",
        "sqlcontent": "SELECT instance_id,order_id,batch_msg,type,ext,waitinginstance_id,kind,parent_id,pricemode,name,makename,taste,spec_detail_name,num,account_num,unit,account_unit,price,member_price,fee,ratio,ratio_fee,ratio_cause,status,kindmenu_id,kindmenu_name,menu_id,memo,is_ratio,entity_id,is_valid,create_time,op_time,last_ver,load_time,modify_time,draw_status,bookmenu_id,make_id,make_price,prodplan_id,is_wait,specdetail_id,specdetail_price,makeprice_mode,original_price,is_buynumber_changed,ratio_operator_id,child_id,kind_bookmenu_id,specprice_mode,worker_id,is_backauth,service_fee_mode,service_fee,orign_id,addition_price,has_addition,seat_id\nFROM instancedetail",
        "dbid": "58",
        "tabid": "62",
        "tabname": "instancedetail"
      },
      "label": "instancedetail"
    },
    {
      "id": "e0245cb9-2e84-55b2-4e6f-f8c88bba4316",
      "x": 696,
      "y": 113,
      "shape": "image",
      "img": "/images/icon/table.svg",
      "size": [
        40,
        40
      ],
      "style": {
        "cursor": "pointer"
      },
      "nodeMeta": {
        "nodeMeta": {
          "type": "table",
          "img": "table.svg",
          "size": [
            40,
            40
          ],
          "label": "数据表"
        },
        "nodeid": "e0245cb9-2e84-55b2-4e6f-f8c88bba4316",
        "sqlcontent": "SELECT pay_id,totalpay_id,kindpay_id,kindpayname,fee,operator,operator_name,pay_time,pay,charge,is_valid,entity_id,create_time,op_time,last_ver,opuser_id,card_id,card_entity_id,online_bill_id,type,code,waitingpay_id,load_time,modify_time,is_dealed,type_name,coupon_fee,coupon_cost,coupon_num,ext,pay_from,parent_entity_id,parent_id,parent_code\nFROM payinfo",
        "dbid": "58",
        "tabid": "63",
        "tabname": "payinfo"
      },
      "label": "payinfo"
    },
    {
      "id": "fb543f81-441f-b9c9-c2b1-038efd556982",
      "x": 847,
      "y": 115,
      "shape": "image",
      "img": "/images/icon/table.svg",
      "size": [
        40,
        40
      ],
      "style": {
        "cursor": "pointer"
      },
      "nodeMeta": {
        "nodeMeta": {
          "type": "table",
          "img": "table.svg",
          "size": [
            40,
            40
          ],
          "label": "数据表"
        },
        "nodeid": "fb543f81-441f-b9c9-c2b1-038efd556982",
        "sqlcontent": "SELECT id,kind_card_id,customer_id,code,inner_code,pwd,pay,active_date,pre_fee,balance,gift_balance,real_balance,degree,pay_amount,consume_amount,ratio_amount,status,get_status,active_id,entity_id,is_valid,create_time,op_time,last_ver,seller_id,last_consume_time,consume_num,extend_fields,kind_card_type,give_balance,card_source,shop_member_system_id,transfer_flg,is_effective,source,activity_source,activity_id\nFROM card",
        "dbid": "61",
        "tabid": "60",
        "tabname": "card"
      },
      "label": "card"
    },
    {
      "id": "e53bc63e-f856-0982-c26b-d5935a326846",
      "x": 924,
      "y": 115,
      "shape": "image",
      "img": "/images/icon/table.svg",
      "size": [
        40,
        40
      ],
      "style": {
        "cursor": "pointer"
      },
      "nodeMeta": {
        "nodeMeta": {
          "type": "table",
          "img": "table.svg",
          "size": [
            40,
            40
          ],
          "label": "数据表"
        },
        "nodeid": "e53bc63e-f856-0982-c26b-d5935a326846",
        "sqlcontent": "SELECT id,mobile,phone,sex,birthday,certificate,spell,name,entity_id,is_valid,create_time,op_time,last_ver,contry_id,contry_code,consume_amount,last_consume_time,consume_num,extend_fields,country_code\nFROM customer",
        "dbid": "61",
        "tabid": "61",
        "tabname": "customer"
      },
      "label": "customer"
    },
    {
      "id": "c566823a-dd97-5322-788d-7b2178dc4100",
      "x": 1026,
      "y": 116,
      "shape": "image",
      "img": "/images/icon/table.svg",
      "size": [
        40,
        40
      ],
      "style": {
        "cursor": "pointer"
      },
      "nodeMeta": {
        "nodeMeta": {
          "type": "table",
          "img": "table.svg",
          "size": [
            40,
            40
          ],
          "label": "数据表"
        },
        "nodeid": "c566823a-dd97-5322-788d-7b2178dc4100",
        "sqlcontent": "SELECT id,order_id,expense_id,approve_amount,head,order_time,shop_name,tax_id,invoice_status,invoice_record_id,ticket_type,paid_amount,enterprise_id,invoice_source,selected,invoice_id,can_invoice_amount,calculate_status,can_expense_amount,totalpay_id,invoice_type,expense_platform,trace_company,trace_number,invoice_address,invoice_preview_address,people_num,entity_id,attribute,create_time,last_ver,op_time,is_valid,type,status\nFROM ent_expense_order",
        "dbid": "62",
        "tabid": "64",
        "tabname": "ent_expense_order"
      },
      "label": "ent_expense_order"
    },
    {
      "id": "ee32dc47-b03c-1c7e-be3f-d279ae1dc86d",
      "x": 1153,
      "y": 115,
      "shape": "image",
      "img": "/images/icon/table.svg",
      "size": [
        40,
        40
      ],
      "style": {
        "cursor": "pointer"
      },
      "nodeMeta": {
        "nodeMeta": {
          "type": "table",
          "img": "table.svg",
          "size": [
            40,
            40
          ],
          "label": "数据表"
        },
        "nodeid": "ee32dc47-b03c-1c7e-be3f-d279ae1dc86d",
        "sqlcontent": "SELECT id,staff_id,invoice_record_id,enterprise_id,customer_id,customer_name,mobile,expense_id,ticket_type,expense_type,paid_amount,apply_expense_amount,mutiple,approve_amount,approver_time,expense_status,approver,remark,attribute,create_time,last_ver,op_time,is_valid,type,status\nFROM ent_expense",
        "dbid": "62",
        "tabid": "65",
        "tabname": "ent_expense"
      },
      "label": "ent_expense"
    },
    {
      "id": "8bc75c1a-3282-cf52-a458-9d63812ea54f",
      "x": 533,
      "y": 322,
      "shape": "image",
      "img": "/images/icon/table.svg",
      "size": [
        40,
        40
      ],
      "style": {
        "cursor": "pointer"
      },
      "nodeMeta": {
        "nodeMeta": {
          "type": "table",
          "img": "table.svg",
          "size": [
            40,
            40
          ],
          "label": "数据表"
        },
        "nodeid": "8bc75c1a-3282-cf52-a458-9d63812ea54f",
        "sqlcontent": "SELECT servicebill_id,outfee,origin_amount,origin_service_charge,origin_least_amount,agio_amount,agio_service_charge,agio_least_amount,origin_receivables_amount,agio_receivables_amount,entity_id,is_valid,agio_total,create_time,op_time,last_ver,op_user_id,reserve_amount,origin_total,final_amount,load_time,modify_time,use_cash_promotion,tax_fee,ext,agio_total_receivables,agio_receivables_amount_receivables,final_amount_receivables\nFROM servicebillinfo",
        "dbid": "58",
        "tabid": "67",
        "tabname": "servicebillinfo"
      },
      "label": "servicebillinfo"
    },
    {
      "id": "973c2f86-ecd5-d6ae-0110-8e25d1d27128",
      "x": 1010,
      "y": 365,
      "shape": "image",
      "img": "/images/icon/table.svg",
      "size": [
        40,
        40
      ],
      "style": {
        "cursor": "pointer"
      },
      "nodeMeta": {
        "nodeMeta": {
          "type": "table",
          "img": "table.svg",
          "size": [
            40,
            40
          ],
          "label": "数据表"
        },
        "nodeid": "973c2f86-ecd5-d6ae-0110-8e25d1d27128",
        "sqlcontent": "SELECT id,shop_entity_id,mall_entity_id,mall_type,status,area_id,cash_type,create_time,op_time,last_ver,is_valid\nFROM mall_shop",
        "dbid": "63",
        "tabid": "66",
        "tabname": "mall_shop"
      },
      "label": "mall_shop"
    },
    {
      "id": "6e7b9c50-0fba-8a19-f029-d973e5a833c7",
      "x": 1059,
      "y": 264,
      "shape": "image",
      "img": "/images/icon/cog.svg",
      "size": [
        40,
        40
      ],
      "style": {
        "cursor": "pointer"
      },
      "nodeMeta": {
        "nodeMeta": {
          "type": "join",
          "img": "cog.svg",
          "size": [
            40,
            40
          ],
          "label": "JOIN"
        },
        "id": "6e7b9c50-0fba-8a19-f029-d973e5a833c7",
        "exportName": "card_expense_relative",
        "position": {
          "x": 1059,
          "y": 264
        },
        "sql": " SELECT a.totalpay_id , b.expense_status,a.create_time\n FROM ent_expense_order a \n    INNER JOIN ent_expense b \n    ON (a.expense_id = b.expense_id AND b.is_valid=1 AND a.is_valid=1 )",
        "dependencies": [
          {
            "value": "c566823a-dd97-5322-788d-7b2178dc4100",
            "label": "c566823a-dd97-5322-788d-7b2178dc4100"
          },
          {
            "value": "ee32dc47-b03c-1c7e-be3f-d279ae1dc86d",
            "label": "ee32dc47-b03c-1c7e-be3f-d279ae1dc86d"
          }
        ],
        "edgeIds": [
          "7b73df3a-220d-3bed-159c-bf0dec341571",
          "8de4f517-d701-3d3b-730d-471e8d967ca4"
        ]
      },
      "label": "card_expense_relative"
    },
    {
      "id": "edcac2da-9afd-6fc5-3489-d975fdb224f8",
      "x": 509,
      "y": 251,
      "shape": "image",
      "img": "/images/icon/cog.svg",
      "size": [
        40,
        40
      ],
      "style": {
        "cursor": "pointer"
      },
      "nodeMeta": {
        "nodeMeta": {
          "type": "join",
          "img": "cog.svg",
          "size": [
            40,
            40
          ],
          "label": "JOIN"
        },
        "id": "edcac2da-9afd-6fc5-3489-d975fdb224f8",
        "exportName": "order_customers",
        "position": {
          "x": 509,
          "y": 251
        },
        "sql": " SELECT a1.order_id, a1.customer_ids, COALESCE(a2.has_fetch, 0) has_fetch\n   FROM\n     (SELECT i.order_id, concat_ws(',',collect_set( split(i.batch_msg,'[\\\\w\\\\W]*\\\\|')[1])) as customer_ids\n     FROM instancedetail AS i\n     WHERE (  i.is_valid= 1 )\n     GROUP BY i.entity_id, i.order_id\n     ) a1\n   LEFT JOIN\n     (SELECT i.order_id, CASE WHEN SUM( OP_AND(i.draw_status,8)) > 0 THEN 1 ELSE 0 END as has_fetch\n      FROM instancedetail AS i\n     WHERE  ( i.is_valid= 1 AND i.status =2)\n     GROUP BY i.entity_id, i.order_id\n     ) a2\n   ON a1.order_id = a2.order_id",
        "dependencies": [
          {
            "value": "f9e4a170-3f57-d541-b27e-b089ebf1ba75",
            "label": "f9e4a170-3f57-d541-b27e-b089ebf1ba75"
          }
        ],
        "edgeIds": [
          "15747238-0404-566c-e1f0-9fb95d7b96f7"
        ]
      },
      "label": "order_customers"
    },
    {
      "id": "d1fc10f7-b464-754c-be32-939b052ffcfd",
      "x": 395,
      "y": 369,
      "shape": "image",
      "img": "/images/icon/cog.svg",
      "size": [
        40,
        40
      ],
      "style": {
        "cursor": "pointer"
      },
      "nodeMeta": {
        "nodeMeta": {
          "type": "join",
          "img": "cog.svg",
          "size": [
            40,
            40
          ],
          "label": "JOIN"
        },
        "id": "d1fc10f7-b464-754c-be32-939b052ffcfd",
        "exportName": "order_instance",
        "position": {
          "x": 395,
          "y": 369
        },
        "sql": " SELECT o.totalpay_id ,o.people_count, o.order_id, o.area_id ,o.seat_id ,o.mobile,o.address\n           ,o.is_valid AS is_valido , o.order_from , o.order_kind,o.open_time,o.end_time,o.order_status\n           ,o.inner_code ,o.code ,o.seat_code ,obill.final_amount AS bill_info_final_amount\n           ,ctm.customer_ids,ctm.has_fetch,o.customerregister_id , toe.courier_phone , toe.out_id\n     FROM  orderdetail o\n           LEFT JOIN order_bill AS obill on(o.order_id = obill.order_id AND obill.is_valid=1 AND obill.is_valid=3)\n           LEFT JOIN order_customers AS ctm ON (o.order_id = ctm.order_id)\n           LEFT JOIN takeout_order_extra AS toe \n             ON (o.order_id = toe.order_id  AND toe.courier_phone IS NOT NULL)\n    WHERE  o.is_valid=1",
        "dependencies": [
          {
            "value": "d56d4423-33dc-2adc-c5a8-e26df611df77",
            "label": "orderdetail"
          },
          {
            "value": "e6c9be82-d622-4e0f-db4e-f94df75518f3",
            "label": "order_bill"
          },
          {
            "value": "edcac2da-9afd-6fc5-3489-d975fdb224f8",
            "label": "order_customers"
          },
          {
            "value": "40f71f97-2591-3e29-d852-3ff2c26c4203",
            "label": "takeout_order_extra"
          }
        ],
        "edgeIds": [
          "c78443c1-524c-f9f3-278f-2fd54586e7b9",
          "cbe147cb-d623-a410-b1f4-6e9be54a34a0",
          "2749b5fb-1360-981b-858c-34694574d99d",
          "719e7a71-9d9f-17eb-05e4-2a0602df84cc"
        ]
      },
      "label": "order_instance"
    },
    {
      "id": "615b3eb0-636c-535e-044a-0d8083d6036b",
      "x": 825,
      "y": 342,
      "shape": "image",
      "img": "/images/icon/cog.svg",
      "size": [
        40,
        40
      ],
      "style": {
        "cursor": "pointer"
      },
      "nodeMeta": {
        "nodeMeta": {
          "type": "join",
          "img": "cog.svg",
          "size": [
            40,
            40
          ],
          "label": "JOIN"
        },
        "id": "615b3eb0-636c-535e-044a-0d8083d6036b",
        "exportName": "tmp_customer_card",
        "position": {
          "x": 825,
          "y": 342
        },
        "sql": " SELECT cd.entity_id,cd.id,cd.code,cd.inner_code,cd.customer_id,c.name,c.spell,c.mobile,c.phone\n   , CASE WHEN regexp(cd.id,'^E_') THEN 1 ELSE 0 END AS is_enterprise_card\n  FROM card cd INNER JOIN customer c \n       ON (cd.customer_id = c.id AND cd.entity_id=c.entity_id ) ",
        "dependencies": [
          {
            "value": "fb543f81-441f-b9c9-c2b1-038efd556982",
            "label": "fb543f81-441f-b9c9-c2b1-038efd556982"
          },
          {
            "value": "e53bc63e-f856-0982-c26b-d5935a326846",
            "label": "e53bc63e-f856-0982-c26b-d5935a326846"
          }
        ],
        "edgeIds": [
          "3a66716d-0ba7-89a7-08ab-dd3ec02eb0bc",
          "e459d6bf-e078-ef4c-3bbb-2d1aabeb4662"
        ]
      },
      "label": "tmp_customer_card"
    },
    {
      "id": "f168574b-6144-f6a8-d121-b4d01ea605c3",
      "x": 589,
      "y": 253,
      "shape": "image",
      "img": "/images/icon/cog.svg",
      "size": [
        40,
        40
      ],
      "style": {
        "cursor": "pointer"
      },
      "nodeMeta": {
        "nodeMeta": {
          "type": "join",
          "img": "cog.svg",
          "size": [
            40,
            40
          ],
          "label": "JOIN"
        },
        "id": "f168574b-6144-f6a8-d121-b4d01ea605c3",
        "exportName": "tmp_group_specialfee",
        "position": {
          "x": 589,
          "y": 253
        },
        "sql": "SELECT sf.entity_id,sf.totalpay_id\n       ,concat_ws( ';',collect_list(concat_ws( '_',cast(sf.kind AS STRING ) , cast(sf.fee AS STRING )  ))) AS special_fee_summary\n   FROM specialfee sf\n   WHERE sf.is_valid = 1\n   GROUP BY sf.entity_id, sf.totalpay_id",
        "dependencies": [
          {
            "value": "a240c9ca-93da-6e79-6712-c7d2de4f2629",
            "label": "a240c9ca-93da-6e79-6712-c7d2de4f2629"
          }
        ],
        "edgeIds": [
          "c481e1cb-dcf2-c60d-03d5-c5434311e0c7"
        ]
      },
      "label": "tmp_group_specialfee"
    },
    {
      "id": "5f7db367-d8a1-dd9f-8097-a37dc6606354",
      "x": 687,
      "y": 251,
      "shape": "image",
      "img": "/images/icon/cog.svg",
      "size": [
        40,
        40
      ],
      "style": {
        "cursor": "pointer"
      },
      "nodeMeta": {
        "nodeMeta": {
          "type": "join",
          "img": "cog.svg",
          "size": [
            40,
            40
          ],
          "label": "JOIN"
        },
        "id": "5f7db367-d8a1-dd9f-8097-a37dc6606354",
        "exportName": "tmp_pay",
        "position": {
          "x": 687,
          "y": 251
        },
        "sql": "SELECT aa.totalpay_id, concat_ws(';', collect_list(aa.aakindpay)) as kindpay\n  ,SUM(aa.fee) as fee\n  ,CASE WHEN sum(aa.is_enterprise_card_pay) >0 THEN 1 ELSE 0 END AS is_enterprise_card_pay\n  ,concat_ws(',',collect_list(aa.pay_customer_ids)) as pay_customer_ids\n  FROM (\n      SELECT \n           p.totalpay_id  \n         , SUM(p.fee) AS fee  \n         , concat_ws( '_', COALESCE( p.kindpay_id,'0')\n            , cast(count(1) AS STRING) \n            , cast(round(sum(p.fee),2) AS STRING)\n            , cast(\n               SUM(\n                 (COALESCE(p.coupon_fee,0) - COALESCE(p.coupon_cost,0)) * COALESCE(p.coupon_num, 0)\n              ) AS STRING)\n            , COALESCE( cast(min(p.pay_id) AS STRING),'0')\n          ) AS aakindpay\n         , SUM( CASE WHEN p.type = 103 THEN 1 ELSE 0 END ) AS is_enterprise_card_pay\n         , concat_ws(',', collect_list( get_json_object( p.ext, '$.customerRegisterId'))) AS pay_customer_ids\n      FROM payinfo as p\n      WHERE length(p.kindpay_id)> 0 AND p.is_valid=1\n      GROUP BY p.totalpay_id ,p.kindpay_id \n  ) AS aa\n  GROUP BY aa.totalpay_id",
        "dependencies": [
          {
            "value": "e0245cb9-2e84-55b2-4e6f-f8c88bba4316",
            "label": "e0245cb9-2e84-55b2-4e6f-f8c88bba4316"
          }
        ],
        "edgeIds": [
          "d171ba3e-bad3-e264-d321-9188aa59decd"
        ]
      },
      "label": "tmp_pay"
    },
    {
      "id": "9f2752a8-d920-79c8-6ba5-31a74019ecb9",
      "x": 699,
      "y": 537,
      "shape": "image",
      "img": "/images/icon/cog.svg",
      "size": [
        40,
        40
      ],
      "style": {
        "cursor": "pointer"
      },
      "nodeMeta": {
        "nodeMeta": {
          "type": "join",
          "img": "cog.svg",
          "size": [
            40,
            40
          ],
          "label": "JOIN"
        },
        "id": "9f2752a8-d920-79c8-6ba5-31a74019ecb9",
        "exportName": "totalpay_summary",
        "position": {
          "x": 699,
          "y": 537
        },
        "sql": "SELECT tp.totalpay_id,tp.outfee,tp.curr_date,tp.source_amount,tp.discount_amount,tp.coupon_discount\n         ,tp.result_amount,tp.recieve_amount,tp.ratio,tp.status,tp.entity_id\n         ,tp.is_valid,tp.op_time,tp.last_ver,tp.op_user_id,tp.discount_plan_id\n         ,tp.operator,tp.operate_date,tp.card_id,tp.card,tp.card_entity_id\n         ,tp.is_full_ratio,tp.is_minconsume_ratio,tp.is_servicefee_ratio,tp.invoice_code\n         ,tp.invoice_memo,tp.invoice,tp.over_status,tp.is_hide,tp.load_time,tp.modify_time\n         ,o.order_id,o.seat_id,o.area_id,o.is_valido ,o.people_count \n         ,o.order_from \n         ,o.order_kind\n         ,o.inner_code\n         ,o.open_time\n         ,o.end_time\n         ,o.order_status\n         ,o.code , o.seat_code , o.customer_ids, o.has_fetch,o.customerregister_id\n         ,o.mobile AS order_mobile\n         ,o.address AS order_address\n         ,o.courier_phone\n         ,o.out_id\n         ,p.kindpay,p.fee as all_pay_fee,p.pay_customer_ids\n         ,sp.special_fee_summary\n         ,cc.code as card_code,cc.inner_code as card_inner_code,cc.customer_id as card_customer_id\n         ,cc.name as card_customer_name,cc.spell AS card_customer_spell\n         ,cc.mobile AS card_customer_moble\n         ,cc.phone AS card_customer_phone\n         ,o.bill_info_final_amount\n         ,sbill.final_amount AS service_bill_final_amount\n         , cd_exp.expense_status\n         , cd_exp.create_time as expense_create_time\n         , CASE WHEN (cc.is_enterprise_card > 0) OR (p.is_enterprise_card_pay >0) THEN 1 ELSE 0 END AS is_enterprise_card\n         , m.mall_entity_id AS mall_id\n         , tp.pt as ptt,tp.pmod\n FROM totalpayinfo tp INNER JOIN order_instance o ON (tp.totalpay_id = o.totalpay_id)\n     LEFT JOIN tmp_pay p ON (tp.totalpay_id = p.totalpay_id)\n                     LEFT JOIN tmp_group_specialfee sp ON( tp.totalpay_id = sp.totalpay_id AND tp.entity_id = sp.entity_id  )\n                     LEFT JOIN tmp_customer_card AS cc on(tp.card_id = cc.id AND tp.entity_id= cc.entity_id)\n                     LEFT JOIN servicebillinfo AS sbill on(tp.totalpay_id = sbill.servicebill_id AND sbill.is_valid=1)\n                     LEFT JOIN card_expense_relative AS cd_exp ON ( tp.totalpay_id = cd_exp.totalpay_id)\n                     LEFT JOIN mall_shop AS m ON (tp.entity_id = m.shop_entity_id AND m.is_valid=1 ) \n        WHERE tp.pt='20191101' and  cast(tp.curr_date as bigint) > 20191101",
        "dependencies": [
          {
            "value": "683deaa9-92c6-0022-1d27-40ba500077e5",
            "label": "totalpayinfo"
          },
          {
            "value": "d1fc10f7-b464-754c-be32-939b052ffcfd",
            "label": "order_instance"
          },
          {
            "value": "f168574b-6144-f6a8-d121-b4d01ea605c3",
            "label": "tmp_group_specialfee"
          },
          {
            "value": "615b3eb0-636c-535e-044a-0d8083d6036b",
            "label": "tmp_customer_card"
          },
          {
            "value": "6e7b9c50-0fba-8a19-f029-d973e5a833c7",
            "label": "card_expense_relative"
          },
          {
            "value": "5f7db367-d8a1-dd9f-8097-a37dc6606354",
            "label": "tmp_pay"
          },
          {
            "value": "8bc75c1a-3282-cf52-a458-9d63812ea54f",
            "label": "servicebillinfo"
          },
          {
            "value": "973c2f86-ecd5-d6ae-0110-8e25d1d27128",
            "label": "mall_shop"
          }
        ],
        "edgeIds": [
          "ef96bffd-0299-4053-682b-50fbcb1b2678",
          "bd6c0bda-e067-7d6f-b56b-c0aaf08427e1",
          "bdb9621b-ea76-8099-8d57-1394097602b8",
          "a4091769-7212-6f87-102e-da4839313846",
          "a466e8f4-9ac7-3e8d-69a0-9a6387056263",
          "0de73176-3d52-a90e-3b2b-c3c70003bc46",
          "fa683ef2-ea52-40da-066b-07b223f06933",
          "d2069a20-a197-86ec-391a-2cd758bdd5ae"
        ]
      },
      "label": "totalpay_summary"
    },
    {
      "id": "40f71f97-2591-3e29-d852-3ff2c26c4203",
      "x": 185,
      "y": 173.4000015258789,
      "shape": "image",
      "img": "/images/icon/table.svg",
      "size": [
        40,
        40
      ],
      "style": {
        "cursor": "pointer"
      },
      "nodeMeta": {
        "nodeMeta": {
          "type": "table",
          "img": "table.svg",
          "size": [
            40,
            40
          ],
          "label": "数据表"
        },
        "nodeid": "40f71f97-2591-3e29-d852-3ff2c26c4203",
        "sqlcontent": "SELECT order_id,order_from,view_id,has_invoiced,invoice_title,is_third_shipping,activity,day_seq,courier_name,courier_phone,cancel_reason,entity_id,ext,out_id,last_ver,begin_expect_date,end_expect_date\nFROM takeout_order_extra",
        "dbid": "58",
        "tabid": "68",
        "tabname": "takeout_order_extra"
      },
      "label": "takeout_order_extra"
    }
  ],
  "edges": [
    {
      "id": "7b73df3a-220d-3bed-159c-bf0dec341571",
      "source": "6e7b9c50-0fba-8a19-f029-d973e5a833c7",
      "target": "c566823a-dd97-5322-788d-7b2178dc4100",
      "style": {
        "endArrow": true
      },
      "startPoint": {
        "x": 1054.5405405405406,
        "y": 244
      },
      "endPoint": {
        "x": 1030.4594594594594,
        "y": 136
      }
    },
    {
      "id": "8de4f517-d701-3d3b-730d-471e8d967ca4",
      "source": "6e7b9c50-0fba-8a19-f029-d973e5a833c7",
      "target": "ee32dc47-b03c-1c7e-be3f-d279ae1dc86d",
      "style": {
        "endArrow": true
      },
      "startPoint": {
        "x": 1071.6174496644296,
        "y": 244
      },
      "endPoint": {
        "x": 1140.3825503355704,
        "y": 135
      }
    },
    {
      "id": "15747238-0404-566c-e1f0-9fb95d7b96f7",
      "source": "edcac2da-9afd-6fc5-3489-d975fdb224f8",
      "target": "f9e4a170-3f57-d541-b27e-b089ebf1ba75",
      "style": {
        "endArrow": true
      },
      "startPoint": {
        "x": 514.2112676056338,
        "y": 231
      },
      "endPoint": {
        "x": 540.7887323943662,
        "y": 129
      }
    },
    {
      "id": "3a66716d-0ba7-89a7-08ab-dd3ec02eb0bc",
      "source": "615b3eb0-636c-535e-044a-0d8083d6036b",
      "target": "fb543f81-441f-b9c9-c2b1-038efd556982",
      "style": {
        "endArrow": true
      },
      "startPoint": {
        "x": 826.9383259911895,
        "y": 322
      },
      "endPoint": {
        "x": 845.0616740088105,
        "y": 135
      }
    },
    {
      "id": "e459d6bf-e078-ef4c-3bbb-2d1aabeb4662",
      "source": "615b3eb0-636c-535e-044a-0d8083d6036b",
      "target": "e53bc63e-f856-0982-c26b-d5935a326846",
      "style": {
        "endArrow": true
      },
      "startPoint": {
        "x": 833.7224669603524,
        "y": 322
      },
      "endPoint": {
        "x": 915.2775330396476,
        "y": 135
      }
    },
    {
      "id": "c481e1cb-dcf2-c60d-03d5-c5434311e0c7",
      "source": "f168574b-6144-f6a8-d121-b4d01ea605c3",
      "target": "a240c9ca-93da-6e79-6712-c7d2de4f2629",
      "style": {
        "endArrow": true
      },
      "startPoint": {
        "x": 594.7142857142857,
        "y": 233
      },
      "endPoint": {
        "x": 623.2857142857143,
        "y": 133
      }
    },
    {
      "id": "d171ba3e-bad3-e264-d321-9188aa59decd",
      "source": "5f7db367-d8a1-dd9f-8097-a37dc6606354",
      "target": "e0245cb9-2e84-55b2-4e6f-f8c88bba4316",
      "style": {
        "endArrow": true
      },
      "startPoint": {
        "x": 688.304347826087,
        "y": 231
      },
      "endPoint": {
        "x": 694.695652173913,
        "y": 133
      }
    },
    {
      "id": "ef96bffd-0299-4053-682b-50fbcb1b2678",
      "source": "9f2752a8-d920-79c8-6ba5-31a74019ecb9",
      "target": "683deaa9-92c6-0022-1d27-40ba500077e5",
      "style": {
        "endArrow": true
      },
      "startPoint": {
        "x": 702.3729216152019,
        "y": 517
      },
      "endPoint": {
        "x": 766.6270783847981,
        "y": 136
      }
    },
    {
      "id": "bd6c0bda-e067-7d6f-b56b-c0aaf08427e1",
      "source": "9f2752a8-d920-79c8-6ba5-31a74019ecb9",
      "target": "d1fc10f7-b464-754c-be32-939b052ffcfd",
      "style": {
        "endArrow": true
      },
      "startPoint": {
        "x": 679,
        "y": 525.9473684210526
      },
      "endPoint": {
        "x": 415,
        "y": 380.05263157894734
      }
    },
    {
      "id": "bdb9621b-ea76-8099-8d57-1394097602b8",
      "source": "9f2752a8-d920-79c8-6ba5-31a74019ecb9",
      "target": "f168574b-6144-f6a8-d121-b4d01ea605c3",
      "style": {
        "endArrow": true
      },
      "startPoint": {
        "x": 691.2535211267606,
        "y": 517
      },
      "endPoint": {
        "x": 596.7464788732394,
        "y": 273
      }
    },
    {
      "id": "a4091769-7212-6f87-102e-da4839313846",
      "source": "9f2752a8-d920-79c8-6ba5-31a74019ecb9",
      "target": "615b3eb0-636c-535e-044a-0d8083d6036b",
      "style": {
        "endArrow": true
      },
      "startPoint": {
        "x": 711.9230769230769,
        "y": 517
      },
      "endPoint": {
        "x": 812.0769230769231,
        "y": 362
      }
    },
    {
      "id": "a466e8f4-9ac7-3e8d-69a0-9a6387056263",
      "source": "9f2752a8-d920-79c8-6ba5-31a74019ecb9",
      "target": "6e7b9c50-0fba-8a19-f029-d973e5a833c7",
      "style": {
        "endArrow": true
      },
      "startPoint": {
        "x": 719,
        "y": 521.8333333333334
      },
      "endPoint": {
        "x": 1039,
        "y": 279.1666666666667
      }
    },
    {
      "id": "0de73176-3d52-a90e-3b2b-c3c70003bc46",
      "source": "9f2752a8-d920-79c8-6ba5-31a74019ecb9",
      "target": "5f7db367-d8a1-dd9f-8097-a37dc6606354",
      "style": {
        "endArrow": true
      },
      "startPoint": {
        "x": 698.1608391608391,
        "y": 517
      },
      "endPoint": {
        "x": 687.8391608391609,
        "y": 271
      }
    },
    {
      "id": "fa683ef2-ea52-40da-066b-07b223f06933",
      "source": "9f2752a8-d920-79c8-6ba5-31a74019ecb9",
      "target": "8bc75c1a-3282-cf52-a458-9d63812ea54f",
      "style": {
        "endArrow": true
      },
      "startPoint": {
        "x": 683.5581395348837,
        "y": 517
      },
      "endPoint": {
        "x": 548.4418604651163,
        "y": 342
      }
    },
    {
      "id": "d2069a20-a197-86ec-391a-2cd758bdd5ae",
      "source": "9f2752a8-d920-79c8-6ba5-31a74019ecb9",
      "target": "973c2f86-ecd5-d6ae-0110-8e25d1d27128",
      "style": {
        "endArrow": true
      },
      "startPoint": {
        "x": 719,
        "y": 525.9389067524115
      },
      "endPoint": {
        "x": 990,
        "y": 376.0610932475884
      }
    },
    {
      "id": "c78443c1-524c-f9f3-278f-2fd54586e7b9",
      "source": "d1fc10f7-b464-754c-be32-939b052ffcfd",
      "target": "d56d4423-33dc-2adc-c5a8-e26df611df77",
      "style": {
        "endArrow": true
      },
      "startPoint": {
        "x": 389.5593869731801,
        "y": 349
      },
      "endPoint": {
        "x": 329.4406130268199,
        "y": 128
      }
    },
    {
      "id": "cbe147cb-d623-a410-b1f4-6e9be54a34a0",
      "source": "d1fc10f7-b464-754c-be32-939b052ffcfd",
      "target": "e6c9be82-d622-4e0f-db4e-f94df75518f3",
      "style": {
        "endArrow": true
      },
      "startPoint": {
        "x": 397.7169811320755,
        "y": 349
      },
      "endPoint": {
        "x": 428.2830188679245,
        "y": 124
      }
    },
    {
      "id": "2749b5fb-1360-981b-858c-34694574d99d",
      "source": "d1fc10f7-b464-754c-be32-939b052ffcfd",
      "target": "edcac2da-9afd-6fc5-3489-d975fdb224f8",
      "style": {
        "endArrow": true
      },
      "startPoint": {
        "x": 414.3220338983051,
        "y": 349
      },
      "endPoint": {
        "x": 489.6779661016949,
        "y": 271
      }
    },
    {
      "id": "719e7a71-9d9f-17eb-05e4-2a0602df84cc",
      "source": "d1fc10f7-b464-754c-be32-939b052ffcfd",
      "target": "40f71f97-2591-3e29-d852-3ff2c26c4203",
      "style": {
        "endArrow": true
      },
      "startPoint": {
        "x": 375,
        "y": 350.37142871675036
      },
      "endPoint": {
        "x": 205,
        "y": 192.02857280912855
      }
    }
  ],
  "topologyName": "totalpay"
}